#!/bin/bash
# Ingest.ctdgv-m-glider_recovered         /omc_data/whoi/OMC/GP05MOAS-GL001/R00001/merged/unit*.mrg         GP05MOAS-GLnnn-04-CTDGVM000
# Ingest.dosta-abcdjm-glider_recovered    /omc_data/whoi/OMC/GP05MOAS-GL001/R00001/merged/unit*.mrg         GP05MOAS-GLnnn-02-DOSTAM000
# Ingest.flord-m-glider_recovered         /omc_data/whoi/OMC/GP05MOAS-GL001/R00001/merged/unit*.mrg         GP05MOAS-GLnnn-01-FLORDM000
# Ingest.glider-eng-glider_recovered      /omc_data/whoi/OMC/GP05MOAS-GL001/R00001/merged/unit*.mrg         GP05MOAS-GLnnn-00-ENG000000

INGS=/home/developer/uframes/ooi/bin/ingestsender
INGESTLOG=/home/wdk/race/log/new-ingest-gp-glider-command.log
INGESTLOGT=/home/wdk/race/log/new-ingest-gp-glider-command.log-T
EDEXSRV=/home/developer/uframes/ooi/bin/edex-server
source $EDEXSRV

EDEXLOGDIR=/home/developer/uframes/ooi/uframe-1.0/edex/logs
EDEXLOGFILES=$(ls $EDEXLOGDIR/edex-ooi*.log)

date
echo "starting full-ingest-gp-glider.sh"

#Pick up files from folder:
GL1D2=/omc_data/whoi/OMC/GP05MOAS-GL001/R00001/merged/unit*.mrg

GL1D2_files=$(find $GL1D2  -print)

#define UFrame Route:
declare -x UFR=(Ingest.glider-eng-glider_recovered
                Ingest.flord-m-glider_recovered  
                Ingest.dosta-abcdjm-glider_recovered 
                Ingest.ctdgv-m-glider_recovered)

#define Glider Reference Desingnator:
declare -x GL1REFDES=(GP05MOAS-GL001-00-ENG000000
                      GP05MOAS-GL001-01-FLORDM000
                      GP05MOAS-GL001-02-DOSTAM000 
                      GP05MOAS-GL001-04-CTDGVM000) 
                
# recovered
for g1d2 in $GL1D2_files
do
    if  grep --quiet $g1d2 $EDEXLOGFILES; then
        echo "move on" > /dev/null
    else
        ls -l $g1d2
        for i in {0..3}
        do
            echo "$INGS ${UFR[i]} $g1d2 ${GL1REFDES[i]} recovered"
                  $INGS ${UFR[i]} $g1d2 ${GL1REFDES[i]} recovered
            sleep 3
        done
    fi
    
done

date
echo "ended ingest-gp-glider.sh"
